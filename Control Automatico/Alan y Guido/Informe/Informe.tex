\input{Header.tex}

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%
%		Caratula		%
%%%%%%%%%%%%%%%%%%%%%%%%%

\input{Caratula.tex}

%%%%%%%%%%%%%%%%%%%%%
%		Indice		%
%%%%%%%%%%%%%%%%%%%%%

\tableofcontents
\newpage

%%%%%%%%%%%%%%%%%%%%%
%		Informe		%
%%%%%%%%%%%%%%%%%%%%%

\section{Simulación del Carro con Péndulo Simple}

Para la simulación del carro con péndulo simple se creó un modelo de este utilizando Simscape de Simulink, utilizando una máscara para poder modificar posteriormente los siguientes parámetros:

\begin{itemize}
\item Masa del carro
\item Masa del péndulo
\item Longitud del Péndulo
\end{itemize}

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/loopshaping/Simscape}
	\caption{Modelo de Simscape utilizado como planta.}
	\label{1_simscape}
\end{figure}

\subsection{Par\'ametros del modelo}
Linealizando se obtuvieron las siguientes matrices. 
\begin{equation*}
A = 
\begin{pmatrix}
0 &  1 & 0 & 0 \\
0 &  0 & 1.7292 & 0 \\
0  & 0 & 0 & 1  \\
0 &  0 & 2.1615 & 0 
\end{pmatrix}
\end{equation*}

\begin{equation*}
B = 
\begin{pmatrix}
0  \\
0.941  \\
0   \\
0.1763  
\end{pmatrix}
\end{equation*}
Ademas se definió la siguiente matriz de salida para el sistema.
\begin{equation*}
C = 
\begin{pmatrix}
0 ; 0; 1 ; 0 \\
1 ; 0; 0 ; 0 
\end{pmatrix}
\end{equation*}
\begin{equation*}
D = 
\begin{pmatrix}
0 \\
0 
\end{pmatrix}
\end{equation*}

\section{Carro con Péndulo Simple: Control en Cascada por Loop Shaping}

Para el control del sistema por loop shaping, como primer paso, se asignaron las variables del modelo de la siguiente forma:

\begin{itemize}
\item Masa del carro = $1 \ kg$
\item Masa del péndulo = $0.25 \ kg$
\item Longitud del Péndulo = $8 \ m$
\end{itemize}

Luego, se utilizó el Model Linearizer de Simulink para linealizar la planta alrededor de $q=0$, $p=0$ y $f=0$; siendo $q$ el ángulo del péndulo, $p$ la posición del carrito y $f$ la fuerza aplicada al carrito.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\linewidth]{Imagenes/loopshaping/equilibrio}
	\caption{Punto de equilibrio de linealización.}
	\label{1_equilibrio}
\end{figure}

De esta manera, se obtuvo la siguiente transferencia desde la fuerza aplicada al carrito al ángulo del péndulo:

\begin{equation}
\frac{Q(s)}{F(s)} = \frac{0.1763}{(s-1.47)(s+1.47)}
\end{equation}

donde se nota la presencia de un polo en el semiplano derecho.

Se cierra un lazo de realimentación, tomando el valor de $q$ e inyectándolo a la entrada con una ganancia de valor $-1$ y se grafica la respuesta en frecuencia del sistema viendo solamente el ángulo $q$, obteniendo:

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{Imagenes/loopshaping/bode_cerrando_q}
	\caption{Respuesta en frencuencia del sistema entre la fuerza aplicada al carrito y el ángulo del péndulo.}
	\label{bode_cerrando_q}
\end{figure}

donde se observa, como se esperaba, que el sistema es inestable. Notando el polo en el semiplano derecho en $1.47 \frac{rad}{s}$, se decide utilizar un controlador que agregue adelanto de fase para obtener una frecuencia de cruce en $w_{cruce} > 1.7 * w_{rhp} = 2.5 \frac{rad}{s}$, eligiendo entonces agregar un cero de $10 \frac{rad}{s}$, quedando entonces:

\begin{equation}
C_2(s) = \frac{s-10}{s-100}
\end{equation} 

Cabe notar que se agregó un polo rápido que no afecte la dinámica del sistema en $100 \frac{rad}{s}$ para lograr un controlador propio.

Luego, se graficó nuevamente la respuesta en frecuencia, obteniendo:

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{Imagenes/loopshaping/bode_cerrando_q_con_controlador}
	\caption{Respuesta en frencuencia del sistema entre la fuerza aplicada al carrito y el ángulo del péndulo con controlador.}
	\label{bode_cerrando_q_con_controlador}
\end{figure}

Se busca un margen de fase de $60$ grados, por lo que se agrega una ganancia de $86 dB$ al controlador, calculado como se observa en la Figura (\ref{bode_cerrando_q_con_controlador}). Finalmente, se tiene que

\begin{equation}
C_2(s) = 1.9953e+04 \cdot \frac{s-10}{s-100}
\end{equation}

Se valida el control graficando una última vez la respuesta en frencuencia quedando:

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{Imagenes/loopshaping/bode_cerrando_q_con_controlador_ganancia}
	\caption{Respuesta en frencuencia del sistema entre la fuerza aplicada al carrito y el ángulo del péndulo con controlador y frecuencia de cruce ajustada.}
	\label{bode_cerrando_q_con_controlador_ganancia}
\end{figure}

donde se observa que el margen de fase es de $\approx 68$ grados.

En este punto del diseño, si se simula el carrito con un disturbio de ruido blanco de un segundo de frecuencia de muestreo, se puede observar que el ángulo es correctamente estabilizado, sin embargo el carrito presenta drift al no ser controlada la posición de este.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{Imagenes/loopshaping/simulacion_solo_angulo}
	\caption{Simulación de la planta controlando únicamente el ángulo del péndulo.}
	\label{simulacion_solo_angulo}
\end{figure}

A continuación, se cierra otro lazo de realimentación por afuera del anterior utilizando la posición del carrito y se grafica la respuesta en frecuencia entre la fuerza aplicada al carrito y la posición de este, obteniendo el siguiente resultado:

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{Imagenes/loopshaping/bode_cerrando_p}
	\caption{Respuesta en frecuencia entre la fuerza aplicada al carrito y la posición de este, cerrando el lazo con realimentación unitaria.}
	\label{bode_cerrando_p}
\end{figure}


\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{Imagenes/loopshaping/simulacion_final}
	\caption{Simulación final de la planta controlando el ángulo del péndulo y la posición del carrito.}
	\label{simulacion_solo_angulo}
\end{figure}
\section{Carro con Péndulo Simple: Control por realimentaci\'on de estados.}
\subsection{Perturbaciones}
Para las perturbaciones y cambios en la referencia se utiliz\'o el siguiente esquema:
Para los cambios de referencia se suma un escalon a la posici\'on de la planta. Y para las perturbaciones para la mayoria de los casos se le sumo a la acci\'on de control un tren de pulsos.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Esquema_general.png}
	\caption{Esquema de perturbaciones y referencia.}
	\label{esq}
\end{figure}

\subsection{Par\'ametros}
 Para la realimentación de estados se tomaron al igual que en loop shaping las matrices producto de la linealizaci\'on de la planta.
 Se probo que esta sea controlable y observable teniendo como salida el \'angulo y posici\'on del carrito.
 Se noto que no era observable el sistema teniendo únicamente como salida el angulo del carrito. Por lo que se opt\'o por conocer tanto la posici\'on como el \'angulo.
 
 \subsection{Realimentaci\'on de estados}
 Teniendo en cuenta que es controlable se realizo una realimetnaci\'on de estados colocando los polos del sistema de la siguiente manera:
 \begin{itemize}
 \item Polo doble en -3
  \item Polo doble en -2
\end{itemize}
utilizando el comando acker.
El esquema de referencias y perturbaciones para este caso es, en el segundo 1 se cambia la referencai a 5m. A los 12 seg se cambia la referencia a -5m. Finalmente en el segundo 25 se introduce un tren de pulsos con periodo 3 segundos con amplitud 500.
En la siguiente imagen se pueden ver 4 señales. En el primer cuadro se observan la referencia y la posición del carrito, en el tercero el ángulo del carrito y en el último las perturbaciones.
Se puede apreciar como al cambiar la referencia la posicion sigue al mismo, y ademas como la introduccion de las perturbaciones provoca cambios tanto en el ángulo como en la posición, pero estas vuelven rapidamente a su condición de equilibrio. 
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_por_realimentacion/general.png}
	\caption{Respuesta del sistema a lazo cerrado.}
	\label{realmentacion}
\end{figure}

Aquí se puede ver que el sistema tienen error permanente esto se debe a que la planta no cuenta con acción integral para corregirlo.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_por_realimentacion/detalle_error_permanente.png}
	\caption{Detalle error permanente.}
	\label{realmentacion_error}
\end{figure}

Asi mismo se realizó un detalle en la interacción disturbio $\sim$ ángulo-posici\'on y como el sistema vuelve a la condici\'on de equilibrio.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_por_realimentacion/detalle_disturbio.png}
	\caption{Detalle disturbios.}
	\label{realmentacion_disturbio}
\end{figure}


 \subsection{Realimentaci\'on de estados con observador discreto}
Finalmente se diseño un observador de estados  para el sistema. Haciendo a este para tiempo discreto.
Para el observador se consideraron polos por lo menos 1 decada mas rapidos que los de la planta, para que pueda reaccionar con rapidez.
Se propuso el siguiente esquema de control:

Ademas se eligi\'o un valor para el tiempo de muestreo. Para esto se busco un tiempo que sea lo mas alto posible y que funcione correctamente el control. Para este caso en particular fue $T_s$=0.1s.
Se propuso el siguiente esquema de control:
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Esquema_general_obs_disc.png}
	\caption{Esquema de control realimentación de estados con observador discreto.}
	\label{esqdisctobs}
\end{figure}

En estas mediciones se puede observar que ademas se agrego una señal que es la discreta, luego del sample and hold.
Se puede apreciar como al cambiar la referencia la posicion sigue al mismo, y ademas como la introduccion de las perturbaciones provoca cambios tanto en el ángulo como en la posición, pero estas vuelven rapidamente a su condición de equilibrio. 
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_Obs_Discreto/general.png}
	\caption{Respuesta del sistema a lazo cerrado.}
	\label{realmentacion}
\end{figure}

Se observa claramente la diferencia entre la señal de posicion real, la discreta y la referencia deseada, al igual de como las tres convergen al mismo punto.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_Obs_Discreto/detalle_angulo_pos.png}
	\caption{Detalle \'angulo posición.}
	\label{realmentacion_error}
\end{figure}

Agregamos finalmente esta imagen para ver como la señal discreta coincide con la señal real cada Ts y como teniendo una frecuencia de muestreo tan chica aun se consigue un control eficaz.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_Obs_Discreto/detalle_real_medido.png}
	\caption{Detalle continuo discreto.}
	\label{realmentacion_disturbio}
\end{figure}


\subsection{Realimentaci\'on de estados con control integral}
Adicionalmente se hizo una realimentaci\'on de estados con control integral, teniendo como salida la posici\'on del carrito. Esto trae un problema el cual es que deja de ser observable el sistema, por lo que el sistema no podría realizarse con las salidas definidas, habria que tener una mayor informacion de las otras variables.
Se propuso el siguiente esquema de control:
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Esquema_general_int.png}
	\caption{Esquema de control realimentación de estados con acción integral.}
	\label{esqint}
\end{figure}

Se puede apreciar como al cambiar la referencia la posicion sigue al mismo, y ademas como la introduccion de las perturbaciones provoca cambios tanto en el ángulo como en la posición, pero estas vuelven rapidamente a su condición de equilibrio. 
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_por_realimentacion_integral/general.png}
	\caption{Respuesta del sistema a lazo cerrado.}
	\label{realmentacion}
\end{figure}

Aquí se puede ver que a diferencia del sistema sin acci\'on integral este no tiene error permanente.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_por_realimentacion_integral/detalle_error_permanente.png}
	\caption{Detalle error permanente.}
	\label{realmentacion_error}
\end{figure}

Asi mismo se realizó un detalle en la interacción disturbio $\sim$ ángulo-posici\'on y como el sistema vuelve a la condici\'on de equilibrio.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_por_realimentacion_integral/detalle_disturbio.png}
	\caption{Detalle disturbios.}
	\label{realmentacion_disturbio}
\end{figure}
\subsection{Realimentaci\'on de estados con control integral en tiempo discreto}
A continuaci\'on se discretiz\'o el sistema a travez de la transformada de tustin. Obteniendo los siguientes resultados:

Se puede apreciar como al cambiar la referencia la posicion sigue al mismo la señal discreta, y ademas como la introduccion de las perturbaciones provoca cambios tanto en el ángulo como en la posición, pero estas vuelven rapidamente a su condición de equilibrio. 
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_integral_disc/general.png}
	\caption{Respuesta del sistema a lazo cerrado.}
	\label{realmentacion}
\end{figure}

Aquí se puede ver que a diferencia del sistema sin acci\'on integral este no tiene error permanente.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_integral_disc/detalle_error_permanente.png}
	\caption{Detalle error permanente.}
	\label{realmentacion_error}
\end{figure}

Asi mismo se realizó un detalle en la interacción disturbio $\sim$ ángulo-posici\'on y como el sistema vuelve a la condici\'on de equilibrio.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_integral_disc/detalle_disturbio.png}
	\caption{Detalle disturbios.}
	\label{realmentacion_disturbio}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{Imagenes/Control_integral_disc/detalle_real_medido.png}
	\caption{Detalle continuo discreto.}
	\label{realmentacion_disturbio}
\end{figure}
\subsection{Realimentaci\'on de estados con control integral en tiempo discreto con observador}
Se le agrego un observador al control integral, teniendo la salvedad que para el observador se tom\'o como salida tanto la posici\'on como el \'angulo, y para la realimentaci\'on integral se uso C como solo la posici\'on. Obteniendo lo siguientes resultados:


\section{Conclusiones}
Se realizo un control por loopshaping enfrentandonos a algunas difcultades como...



Ademas se hicieron realimentación de estados, sin y con observador discreto al igual que un conotrol con acción integral continuo y discreto.
Con las dificultades impuestas por las condiciones de observabilidad y o controlabilidad debido a la salida del sistema.
Ademas se hizo un contorl con acción integral en la posicion con un observador de estados.
\end{document}
